<!DOCTYPE html>
<html>
<head>
    <title>Watermark Photo (Multi)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Vivo-like system font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            padding: 15px;
            max-width: 800px;
            margin: auto;
        }
        .preview-item {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
        }
        .preview-item img {
            width: 100%;
            border: 1px solid #ddd;
            margin-top: 10px;
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            font-size: 16px;
        }
        button {
            background: #007bff;
            border: none;
            color: white;
            border-radius: 5px;
        }
        button:active {
            opacity: 0.7;
        }
    </style>
</head>
<body>

<h2>Add Watermark to Multiple Photos</h2>

<input type="file" id="imageInput" accept="image/*" multiple>

<label>Watermark text:</label>
<input type="text" id="watermarkText" placeholder="2025-01-01 10:30 AM">

<button onclick="addWatermark()">Add Watermark</button>

<div id="previewContainer"></div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
function addWatermark() {
    const files = document.getElementById("imageInput").files;
    const watermark = document.getElementById("watermarkText").value.trim();
    const container = document.getElementById("previewContainer");
    container.innerHTML = ""; // reset preview list

    if (files.length === 0) {
        alert("Please upload at least 1 photo.");
        return;
    }

    Array.from(files).forEach(file => {
        const img = new Image();
        img.src = URL.createObjectURL(file);

        img.onload = function () {
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");

            // Match photo resolution
            canvas.width = img.width;
            canvas.height = img.height;

            ctx.drawImage(img, 0, 0);

            // Vivo-style font
            const fontSize = Math.max(20, img.width * 0.03);
            ctx.font = `${fontSize}px 'Roboto', sans-serif`;
            ctx.fillStyle = "white";
            ctx.textAlign = "left";

            // bottom left position
            const x = fontSize * 0.5;
            const y = canvas.height - (fontSize * 0.5);

            ctx.fillText(watermark, x, y);

            const finalImg = canvas.toDataURL("image/png");

            // Create preview block
            const block = document.createElement("div");
            block.className = "preview-item";

            block.innerHTML = `
                <strong>${file.name}</strong><br>
                <img src="${finalImg}">
                <a download="watermarked_${file.name}" href="${finalImg}">
                    <button>Download This Image</button>
                </a>
            `;

            container.appendChild(block);
        };
    });
}
</script>

</body>
</html>
